<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walking Reminder</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiV2Fsa2luZyBSZW1pbmRlciIsInNob3J0X25hbWUiOiJXYWxrIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiM2NjdlZWEiLCJ0aGVtZV9jb2xvciI6IiM2NjdlZWEiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpRd0lpQm9aV2xuYUhROUlqSTBNQ0lpSUhacFpYZENiM2c5SWpBZ01DQXlOREFnTWpRd0lpQm1hV3hzUFNJaU5qWTJaV1ZoSWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGlCOFBIQmhkR2dnWkQwaWJURXlNQ0EyTUdNeE5qZ3VNVFVnTUNCek16SXVNalVnTVRRdU5UY2dOakF1TnpVZ016SXROekl1TnpWZ056SXVOelVnTXpKak1TNHpNU0F4Tnk0Mk5TQXhOaTQ1T1NBek1pNDFPU0F6TUM0MU1pQTBOaTQxTjdNeE1pNDVNeUF4TkM0eE5pQXlOaTQ1TXlBek15NHhOaUEwTWk0MU5TQTFNaTQxTjdNeE5TNHpOaUF4T1M0ME1TQXpNUzQ0TWlBeE9TNDBNVUEwT1M0NU4ySXhOQzQxTVMxdU1UUXVOREV0WVRFek5TNDFNeUF4TXpVdU5UTWdNQ0F3SURBZ05qa3VOekI2YlRVd0xqSTFJREV5TkdNdE9DNDFNemN0TkM0MU5EWXRNVEl1TmpJdE1USXVOakl0TWpFdU1UWmhNVFl0WVRFek5TNDFNeUF4TXpVdU5UTWdNQ0F3SURBZ05qa3VOekI2SWc9PSIsInNpemVzIjoiMjQweDI0MCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Walk Reminder" />
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9IiM2NjdlZWEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+IDxwYXRoIGQ9Im05MCA0NWMxMjYuMTUgMCBzMjQuNzUgMTAuOTMgNDUuNTYgMjQtNTQuNTYgNTQuNTYgNTQuNTZjMTAuNjIgMTMuMjQgMTIuNDIgMjQuMzcgMjIuOTEgMzguNTdjOS42OSAxMS4wOCAyMC4xOCAyNC42OSAzMS41IDM5LjM3YzEzLjUgMTQuNjUgMjMuODIgMTQuNjVhMTAxLjU2IDEwMS41NiAwIDAgMCA1Mi4xNnoiLz48L3N2Zz4=" />
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #10b981;
            --success-dark: #059669;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --warning: #f59e0b;
            --info: #6366f1;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, #9333ea 100%);
            min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; position:relative;
        }
        body::before {
            content:''; position:fixed; top:0; left:0; width:100%; height:100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(120,119,198,0.3) 0%,transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,119,198,0.3) 0%,transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120,200,255,0.2) 0%,transparent 50%);
            pointer-events:none; animation:float 20s ease-in-out infinite;
        }
        @keyframes float {0%,100%{transform:translateY(0) rotate(0);}50%{transform:translateY(-20px) rotate(180deg);}}

        .app-container {
            background:rgba(255,255,255,0.95); backdrop-filter:blur(20px);
            border-radius:24px; padding:32px; box-shadow:0 25px 50px rgba(0,0,0,0.15),0 0 0 1px rgba(255,255,255,0.1);
            text-align:center; max-width:420px; width:100%; position:relative; border:1px solid rgba(255,255,255,0.2);
            animation:slideUp 0.8s ease;
        }
        @keyframes slideUp {from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}

        .walking-icon {font-size:48px; margin-bottom:16px; animation:walk 2s ease-in-out infinite;}
        @keyframes walk {0%,100%{transform:translateX(0);}50%{transform:translateX(10px);}}

        .app-title {font-size:28px; font-weight:700; margin-bottom:8px;
            background:linear-gradient(135deg,var(--primary),var(--info));
            -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        .app-subtitle {color:var(--gray); font-size:14px; margin-bottom:24px; font-weight:500;}

        .status {font-size:16px; margin:24px 0; padding:16px 20px; border-radius:16px;
            font-weight:600; position:relative; overflow:hidden;
        }
        .status::before {content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);
            transition:left 0.5s;
        }
        .status.active::before {left:100%;}
        .status.active {background:linear-gradient(135deg,rgba(16,185,129,0.1),rgba(5,150,105,0.05));
            color:var(--success-dark); border:2px solid rgba(16,185,129,0.3);
            animation:pulse 2s infinite;
        }
        @keyframes pulse {0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.4);}50%{box-shadow:0 0 0 10px rgba(16,185,129,0);} }
        .status.inactive {background:rgba(100,116,139,0.1); color:var(--gray); border:2px solid rgba(100,116,139,0.2);}        

        .controls {display:flex; gap:12px; margin:28px 0;}
        .btn {flex:1; padding:16px 20px; border:none; border-radius:16px; font-size:15px;
            font-weight:600; text-transform:uppercase; letter-spacing:0.5px; position:relative;
            overflow:hidden; min-height:54px; display:flex; align-items:center; justify-content:center;
            cursor:pointer; transition:all 0.3s ease;
        }
        .btn::before {content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent); transition:left 0.5s;
        }
        .btn:active::before{left:100%;}
        .btn-start {background:linear-gradient(135deg,var(--success),var(--success-dark)); color:#fff;
            box-shadow:0 4px 15px rgba(16,185,129,0.4);
        }
        .btn-stop {background:linear-gradient(135deg,var(--danger),var(--danger-dark)); color:#fff;
            box-shadow:0 4px 15px rgba(239,68,68,0.4);
        }
        .btn-acknowledge {background:linear-gradient(135deg,var(--warning),#f97316); color:#fff;
            box-shadow:0 4px 15px rgba(245,158,11,0.4); margin:16px 0;
        }
        .btn-start:hover:not(:disabled), .btn-stop:hover:not(:disabled), .btn-acknowledge:hover:not(:disabled){transform:translateY(-3px);}
        .btn-start:active,.btn-stop:active,.btn-acknowledge:active{transform:translateY(-1px);}
        .btn:disabled{opacity:0.6;cursor:not-allowed;transform:none!important;}

        .next-reminder {display:none; background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(79,70,229,0.05));
            color:var(--info); padding:20px; border-radius:16px; margin:24px 0;
            border:2px solid rgba(99,102,241,0.2); backdrop-filter:blur(10px);
        }
        .countdown {font-size:32px; font-family:'SF Mono',Monaco,monospace; margin:8px 0; font-weight:700;
            text-shadow:0 2px 4px rgba(99,102,241,0.3);
        }
        .progress-ring {width:80px;height:80px;margin:0 auto 16px;}
        .progress-ring-circle {fill:transparent; stroke:var(--info); stroke-width:4;
            r:36; cx:40; cy:40; stroke-dasharray:226; stroke-dashoffset:226; transition:stroke-dashoffset 0.5s ease;
        }

        .stats-grid {display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:24px;}
        .stat-card {background:rgba(100,116,139,0.05); backdrop-filter:blur(10px);
            padding:20px 16px; border-radius:16px; border:1px solid rgba(100,116,139,0.1);
            transition:transform 0.3s;
        }
        .stat-card:hover{transform:translateY(-2px);}
        .stat-title{font-size:12px; color:var(--gray); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px;}
        .stat-value{font-size:28px; font-weight:800; color:var(--info); font-family:'SF Mono',Monaco,monospace;}

        .health-tip {margin-top:16px; font-style:italic; color:var(--gray); font-size:14px;}
        .motivational-message {display:none; margin-top:16px; font-weight:500; color:var(--success-dark);
            background:rgba(16,185,129,0.1); padding:12px; border-radius:12px; border:1px solid rgba(16,185,129,0.2);
        }

        .settings-panel {margin-top:20px; padding:20px; background:rgba(100,116,139,0.05); border-radius:16px;}
        .setting-item{display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;}
        .toggle{width:50px;height:24px;background:rgba(100,116,139,0.3);border-radius:12px;cursor:pointer;position:relative;transition:background 0.3s;}
        .toggle.active{background:var(--success);}        
        .toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:#fff;border-radius:50%;transition:transform 0.3s;}
        .toggle.active::after{transform:translateX(26px);}
        
        .interval-setting {display: flex; align-items: center; gap: 10px;}
        .interval-setting input {
            width: 70px; padding: 8px; border-radius: 8px; border: 1px solid #ddd;
            text-align: center; font-weight: bold;
        }

        .reminder-popup {
            display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8);
            z-index:1000; justify-content:center; align-items:center; backdrop-filter:blur(10px);
        }
        .reminder-content {
            background:#fff; padding:40px; border-radius:24px; text-align:center; max-width:350px; width:90%;
            box-shadow:0 25px 50px rgba(0,0,0,0.3); animation:popIn 0.5s ease;
        }
        @keyframes popIn {0%{opacity:0;transform:scale(0.8);}100%{opacity:1;transform:scale(1);}}
        .reminder-title {font-size:24px; font-weight:700; margin-bottom:16px; color:var(--primary);}
        .reminder-text {font-size:16px; color:var(--gray); margin-bottom:24px;}
        .reminder-icon {font-size:64px; margin-bottom:16px; animation:bounce 1s infinite;}
        @keyframes bounce {0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}

        @media(max-width:480px){
            .controls{flex-direction:column;} 
            .stats-grid{grid-template-columns:1fr;}
            .app-container{padding:24px; margin:10px;}
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="walking-icon">🚶‍♂️</div>
        <h1 class="app-title">Walking Reminder</h1>
        <p class="app-subtitle">Stay healthy with regular walking breaks</p>
        <div id="status" class="status inactive"><span>Ready to start your work day</span></div>
        <div class="controls">
            <button id="startBtn" class="btn btn-start">🏢 Start Work</button>
            <button id="stopBtn" class="btn btn-stop" disabled>🏠 Go Home</button>
        </div>
        <div id="nextReminder" class="next-reminder">
            <div>Next reminder in:</div>
            <div id="countdown" class="countdown">30:00</div>
            <svg class="progress-ring"><circle id="progressCircle" class="progress-ring-circle"/></svg>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-title">Today's Walks</div><div id="walkCount" class="stat-value">0</div></div>
            <div class="stat-card"><div class="stat-title">Best Streak</div><div id="bestStreak" class="stat-value">0</div></div>
        </div>
        <div id="healthTip" class="health-tip">💡 Regular walking breaks improve circulation, reduce eye strain, and boost productivity!</div>
        <div id="motivationalMessage" class="motivational-message">🎉 Great job! You're building a healthy habit!</div>
        <div class="settings-panel">
            <div class="setting-item"><span>Sound Notifications</span><div id="soundToggle" class="toggle active"></div></div>
            <div class="setting-item"><span>Vibration</span><div id="vibrationToggle" class="toggle active"></div></div>
            <div class="setting-item"><span>Browser Notifications</span><div id="notificationToggle" class="toggle"></div></div>
            <div class="setting-item">
                <span>Reminder Interval (minutes)</span>
                <div class="interval-setting">
                    <input type="number" id="intervalInput" min="1" max="120" value="30">
                </div>
            </div>
        </div>
    </div>

    <!-- Reminder Popup -->
    <div id="reminderPopup" class="reminder-popup">
        <div class="reminder-content">
            <div class="reminder-icon">🚶‍♂️</div>
            <div class="reminder-title">Time to Walk!</div>
            <div class="reminder-text">Take a 2-3 minute walking break to stay healthy and productive.</div>
            <button class="btn btn-acknowledge">✅ I'll Walk Now</button>
        </div>
    </div>
    
    <script>
        // App state variables
        let isActive = false;
        let reminderInterval, countdownInterval, nextReminderTime;
        let walkCount = 0;
        let bestStreak = 0;
        let currentStreak = 0;
        let settings = { 
            sound: true, 
            vibration: true, 
            notifications: false,
            interval: 30 // Default interval in minutes
        };
        
        // Health tips and motivational messages
        const healthTips = [
            "💡 Walking for just 2 minutes can boost your energy and focus!",
            "🧠 Regular breaks improve memory and cognitive function.",
            "❤️ Walking helps reduce stress and lower blood pressure.",
            "👀 Looking away from screens prevents eye strain and fatigue.",
            "🦴 Standing and walking strengthens your bones and muscles."
        ];
        
        const motivationalMessages = [
            "🎉 Awesome! You're building a healthy habit!",
            "💪 Great job taking care of your body!",
            "🌟 You're doing amazing - keep it up!",
            "🏆 Another step towards better health!",
            "✨ Your future self will thank you!"
        ];
        
        // Initialize the app
        function initApp() {
            // Load saved data
            loadSettings();
            loadStats();
            updateHealthTip();
            checkNotificationPermission();
            updateUI();
            
            // Set up event listeners
            document.getElementById('startBtn').addEventListener('click', startReminders);
            document.getElementById('stopBtn').addEventListener('click', stopReminders);
            document.querySelector('.btn-acknowledge').addEventListener('click', acknowledgeReminder);
            document.getElementById('soundToggle').addEventListener('click', toggleSound);
            document.getElementById('vibrationToggle').addEventListener('click', toggleVibration);
            document.getElementById('notificationToggle').addEventListener('click', toggleNotifications);
            document.getElementById('intervalInput').addEventListener('change', updateInterval);
            
            // Set up background timer restoration
            restoreBackgroundTimer();
            
            // Handle visibility change
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && isActive) {
                    console.log('App hidden, saving timer state');
                    saveTimerState();
                } else if (!document.hidden && isActive) {
                    console.log('App visible, restoring timer state');
                    restoreTimerState();
                }
            });
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('walkingSettings');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    settings = { ...settings, ...parsed };
                } catch (e) {
                    console.log('Error loading settings:', e);
                }
            }
            document.getElementById('intervalInput').value = settings.interval;
            updateSettingsUI();
        }
        
        function saveSettings() {
            localStorage.setItem('walkingSettings', JSON.stringify(settings));
        }
        
        function updateInterval() {
            const newInterval = parseInt(document.getElementById('intervalInput').value);
            if (newInterval >= 1 && newInterval <= 120) {
                settings.interval = newInterval;
                saveSettings();
                
                // Restart the timer if active
                if (isActive) {
                    clearTimeout(reminderInterval);
                    clearInterval(countdownInterval);
                    nextReminderTime = Date.now() + settings.interval * 60000;
                    startCountdown();
                    reminderInterval = setTimeout(showReminder, settings.interval * 60000);
                }
            } else {
                alert('Please enter a value between 1 and 120 minutes');
                document.getElementById('intervalInput').value = settings.interval;
            }
        }
        
        function updateSettingsUI() {
            document.getElementById('soundToggle').classList.toggle('active', settings.sound);
            document.getElementById('vibrationToggle').classList.toggle('active', settings.vibration);
            document.getElementById('notificationToggle').classList.toggle('active', settings.notifications);
        }
        
        function toggleSound() {
            settings.sound = !settings.sound;
            saveSettings();
            updateSettingsUI();
            // Play a test sound when toggling on
            if (settings.sound) {
                playNotificationSound();
            }
        }
        
        function toggleVibration() {
            settings.vibration = !settings.vibration;
            saveSettings();
            updateSettingsUI();
            if (settings.vibration && navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        }
        
        function toggleNotifications() {
            if (!settings.notifications && 'Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        settings.notifications = true;
                        saveSettings();
                        updateSettingsUI();
                    }
                });
            } else {
                settings.notifications = !settings.notifications;
                saveSettings();
                updateSettingsUI();
            }
        }
        
        function checkNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'granted') {
                settings.notifications = true;
                updateSettingsUI();
            }
        }
        
        function loadStats() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastDate');
            
            if (lastDate !== today) {
                // New day - reset daily stats
                walkCount = 0;
                localStorage.setItem('lastDate', today);
                localStorage.setItem('walkCount', '0');
            } else {
                walkCount = parseInt(localStorage.getItem('walkCount') || '0');
            }
            
            bestStreak = parseInt(localStorage.getItem('bestStreak') || '0');
            currentStreak = parseInt(localStorage.getItem('currentStreak') || '0');
            
            document.getElementById('walkCount').textContent = walkCount;
            document.getElementById('bestStreak').textContent = bestStreak;
        }
        
        function saveStats() {
            localStorage.setItem('walkCount', walkCount.toString());
            localStorage.setItem('currentStreak', currentStreak.toString());
            localStorage.setItem('bestStreak', bestStreak.toString());
        }
        
        function updateHealthTip() {
            const tip = healthTips[Math.floor(Math.random() * healthTips.length)];
            document.getElementById('healthTip').textContent = tip;
        }
        
        function showMotivationalMessage() {
            const el = document.getElementById('motivationalMessage');
            const message = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 4000);
        }
        
        function updateUI() {
            const status = document.getElementById('status');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (isActive) {
                status.textContent = 'Work mode active - Walking reminders enabled';
                status.className = 'status active';
                startBtn.disabled = true;
                stopBtn.disabled = false;
                document.getElementById('nextReminder').style.display = 'block';
            } else {
                status.textContent = 'Ready to start your work day';
                status.className = 'status inactive';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                document.getElementById('nextReminder').style.display = 'none';
            }
        }
        
        function startReminders() {
            if (isActive) return;
            isActive = true;
            updateUI();
            
            // Request notification permission if needed
            if (!settings.notifications && 'Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        settings.notifications = true;
                        saveSettings();
                        updateSettingsUI();
                    }
                });
            }
            
            // Set the next reminder time
            nextReminderTime = Date.now() + settings.interval * 60000;
            startCountdown();
            reminderInterval = setTimeout(showReminder, settings.interval * 60000);
            showMotivationalMessage();
            
            if (settings.sound) playNotificationSound();
            
            // Save timer state
            saveTimerState();
        }
        
        function stopReminders() {
            isActive = false;
            updateUI();
            clearTimeout(reminderInterval);
            clearInterval(countdownInterval);
            
            // Clear timer state
            localStorage.removeItem('timerState');
            
            if (settings.sound) playNotificationSound();
            updateHealthTip();
        }
        
        function startCountdown() {
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                if (!isActive) return clearInterval(countdownInterval);
                
                const timeLeft = nextReminderTime - Date.now();
                if (timeLeft <= 0) {
                    document.getElementById('countdown').textContent = '00:00';
                    updateProgressRing(100);
                    clearInterval(countdownInterval);
                } else {
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    document.getElementById('countdown').textContent = 
                        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                    
                    // Update progress ring
                    const totalTime = settings.interval * 60000;
                    const elapsed = totalTime - timeLeft;
                    const progress = (elapsed / totalTime) * 100;
                    updateProgressRing(progress);
                }
            }, 1000);
        }
        
        function updateProgressRing(progress = 0) {
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 36;
            const offset = circumference - (progress / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }
        
        function showReminder() {
            document.getElementById('reminderPopup').style.display = 'flex';
            
            if (settings.sound) playNotificationSound();
            if (settings.vibration && navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            if (settings.notifications && 'Notification' in window && Notification.permission === 'granted') {
                new Notification('Time to Walk! 🚶‍♂️', {
                    body: 'Take a 2-3 minute walking break.',
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9IiM2NjdlZWEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+IDxwYXRoIGQ9Im05MCA0NWMxMjYuMTUgMCBzMjQuNzUgMTAuOTMgNDUuNTYgMjQtNTQuNTYgNTQuNTYgNTQuNTZjMTAuNjIgMTMuMjQgMTIuNDIgMjQuMzcgMjIuOTEgMzguNTdjOS42OSAxMS4wOCAyMC4xOCAyNC42OSAzMS41IDM5LjM3YzEzLjUgMTQuNjUgMjMuODIgMTQuNjVhMTAxLjU2IDEwMS41NiAwIDAgMCA1Mi4xNnoiLz48L3N2Zz4=',
                    tag: 'walking-reminder',
                    requireInteraction: true
                });
            }
        }
        
        function acknowledgeReminder() {
            document.getElementById('reminderPopup').style.display = 'none';
            
            walkCount++;
            currentStreak++;
            if (currentStreak > bestStreak) {
                bestStreak = currentStreak;
            }
            
            document.getElementById('walkCount').textContent = walkCount;
            document.getElementById('bestStreak').textContent = bestStreak;
            saveStats();
            showMotivationalMessage();
            updateHealthTip();
            
            if (isActive) {
                nextReminderTime = Date.now() + settings.interval * 60000;
                startCountdown();
                reminderInterval = setTimeout(showReminder, settings.interval * 60000);
                
                // Save timer state
                saveTimerState();
            }
        }
        
        function playNotificationSound() {
            // Create a simple notification sound
            try {
                const audio = new Audio();
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.3;
                
                oscillator.start();
                setTimeout(() => {
                    oscillator.stop();
                }, 300);
            } catch (e) {
                console.log('Audio context error:', e);
                // Fallback to beep if AudioContext fails
                try {
                    const audio = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU");
                    audio.volume = 0.3;
                    audio.play();
                } catch (e) {
                    console.log('Audio playback error:', e);
                }
            }
        }
        
        // Background timer persistence
        function saveTimerState() {
            if (isActive) {
                const timerState = {
                    nextReminderTime: nextReminderTime,
                    interval: settings.interval,
                    savedAt: Date.now()
                };
                localStorage.setItem('timerState', JSON.stringify(timerState));
            }
        }
        
        function restoreTimerState() {
            const timerState = localStorage.getItem('timerState');
            if (timerState) {
                try {
                    const state = JSON.parse(timerState);
                    const elapsed = Date.now() - state.savedAt;
                    const remaining = state.nextReminderTime - state.savedAt - elapsed;
                    
                    if (remaining > 0) {
                        // Timer is still valid
                        nextReminderTime = state.nextReminderTime;
                        startCountdown();
                        reminderInterval = setTimeout(showReminder, remaining);
                    } else {
                        // Timer expired while app was in background
                        showReminder();
                    }
                } catch (e) {
                    console.log('Error restoring timer state:', e);
                }
            }
        }
        
        function restoreBackgroundTimer() {
            const timerState = localStorage.getItem('timerState');
            if (timerState) {
                try {
                    const state = JSON.parse(timerState);
                    const elapsed = Date.now() - state.savedAt;
                    const remaining = state.nextReminderTime - state.savedAt - elapsed;
                    
                    if (remaining > 0) {
                        // Resume the timer
                        isActive = true;
                        nextReminderTime = state.nextReminderTime;
                        updateUI();
                        startCountdown();
                        reminderInterval = setTimeout(showReminder, remaining);
                    } else {
                        // Clear expired timer
                        localStorage.removeItem('timerState');
                    }
                } catch (e) {
                    console.log('Error restoring background timer:', e);
                }
            }
        }
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>